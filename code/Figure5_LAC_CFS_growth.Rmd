---
title: "R Notebook"
author: "Sarah Lucas"
---
# Purpose:
Growth curves were performed with S. aureus strain LAC (USA300) in 8 different supernatants derived from the growth of mucin-degrading microbial communities isolated from CRS patient sinus mucus on minimal mucin medium (batch: 06SEP2019)

# Setup
## Packages
```{r}
library(tidyverse)
library(hms)
library(cowplot)
library(ggpubr)
```
## Plotting
```{r results=FALSE}
cbPal <- c("pink","#E69F00","#56B4E9","#009E73","#F0E442", "#0072B2","#75437C","#B52F25") 
```
## Experiemntal Parameters to fill in: Media in plate
```{r results=FALSE}
Medium.A <- "Super164"
Medium.B <- "Super222"
Medium.C <- "Super230"
Medium.D <- "Super234"
Medium.E <- "Super235"
Medium.F <- "Super243"
Medium.G <- "Super260"
Medium.H <- "Super262"
```
## Experiemntal Parameters to fill in: Samples in wells
```{r results=FALSE}
Bio1 <- "LAC1"
Bio2 <- "LAC2"
Bio3 <- "LAC3"
Bio4 <- "Medium_Control"
```

# Data import and tidying

## Import data
```{r}
start_time <- as.hms(00:00:00)

AerobicData <- read_tsv("../data/enrichment/USA300_growth/Supernatant_Growth_Curves_LAC_11SEP2019.txt", skip = 34) %>%
  select(-contains("600")) %>%
  filter(!is.na(Time)) %>%
  gather(key = Well, value = OD600, A1:H12) %>%
  separate(Well, into = c("rowx","Column"), sep = "[[:alpha:]]", remove = FALSE) %>%
  separate(Well, into = c("Row","columnx"), sep = "[[:digit:]]", remove = FALSE) %>%
  select(Time, Well, Row, Column, OD600) %>%
  mutate(Medium = ifelse(Row == "A", Medium.A,
                         ifelse(Row == "B", Medium.B, 
                                ifelse(Row == "C", Medium.C, 
                                       ifelse(Row == "D", Medium.D,
                                              ifelse(Row == "E", Medium.E, 
                                                     ifelse(Row == "F", Medium.F, 
                                                            ifelse(Row == "G", Medium.G, Medium.H)))))))) %>%
  mutate(BioRep = ifelse(Column %in% 1:3, Bio1,
                         ifelse(Column %in% 4:6, Bio2,
                                ifelse(Column %in% 7:9, Bio3,
                                       Bio4)))) %>%
  mutate(difftime = as.numeric(abs(difftime(start_time, Time, units = "hours"))))
AerobicData$Column <- as.numeric(AerobicData$Column)
```
## Growth Curves by well
```{r}
GC_plate_plot <- ggplot(AerobicData, aes(x=difftime, y=OD600, color = Medium)) + 
  facet_grid(Row ~ Column) +
  theme_classic() + 
  geom_line(size = 1) +
  scale_color_manual(values = c(cbPal)) +
  scale_y_log10() +
  annotation_logticks(base = 10, 
                      sides = "l"
  ) +
  labs(x = "", y = "") +
  theme(legend.position = "right", 
        axis.text.x = element_text(color = "black", size = 6, face = "bold", angle = 90),
        axis.text.y = element_text(color = "black", size = 6, face = "bold")
  )
GC_plate_plot
```
## Normalize
Subtract data blanks at each time point for each medium.
```{r}
data_samples <- AerobicData %>%
  filter(BioRep != "Medium_Control")
  
data_blanks <- AerobicData %>%
  filter(BioRep == "Medium_Control") %>%
  group_by(Medium, Time) %>%
  # Get the average blank value for each supernatant at each timepoint
  summarize(blank_mean_OD600 = mean(OD600))

#Combine data back together
data_join <- left_join(data_samples, data_blanks)
data_join_blank <- data_join %>%
  mutate(blanked_OD600 = OD600 - blank_mean_OD600)
```
## Summarize
Get the mean and standard deviation for each supernatant at each timepoint for plotting
```{r}
data_join_summarized <- data_join_blank %>%
  group_by(Medium, Time, difftime) %>%
  summarize(mean_blanked_OD600 = mean(blanked_OD600), sd_blanked_OD600 = sd(blanked_OD600)) %>%
  ungroup()
data_join_summarized$Time <- hms::as.hms(data_join_summarized$Time)
```
# Plot Growth Curves
## Filter for plotting points and error bars
```{r}
# Filter dataset to just include data from first 12 hours of growth curve
data_join_summarized_filt_12Hr <- filter(data_join_summarized, Time < as.hms("12:00:00"))

# For plotting points and error bars, just filter data to hourly 
# timepoints instead of half hours
data_join_filt_12Hr_error <- filter(data_join_summarized_filt_12Hr, minute(Time) == 29)
data_join_summarized_error <- filter(data_join_summarized, minute(Time) == 29)
```

## Plot
Growth curves are plotted at half hour intervals, while points and error bars are plotted at hourly intervals to avoid overplotting and enable readability of the graph.
```{r}
# plotting points and error bars for when they overlap
pd <- position_dodge(0.1) # move them .05 to the left and right
# Plot
GC_plot_sd <- ggplot(data_join_summarized_filt_12Hr) +
  geom_line(aes(x=difftime, y=mean_blanked_OD600, color = Medium), size = .8) +
  geom_errorbar(data = data_join_filt_12Hr_error, 
                mapping = aes(x = difftime, 
                              ymin = mean_blanked_OD600-sd_blanked_OD600, 
                              ymax = mean_blanked_OD600+sd_blanked_OD600, 
                              color = Medium), position = pd, size = .5, alpha = .6) +
  geom_point(data = data_join_filt_12Hr_error, 
             mapping = aes(x = difftime, 
                           y = mean_blanked_OD600, 
                           color = Medium)) +
  scale_color_manual(breaks = c("Super164",
                                "Super222",
                                "Super230",
                                "Super234",
                                "Super235",
                                "Super243",
                                "Super260",
                                "Super262"), 
                     labels = c("A",
                                "B",
                                "C",
                                "D",
                                "E",
                                "F",
                                "G", 
                                "H"), 
                     name = "Supernatant", 
                     values = cbPal) +
  scale_y_log10(limits = c(.01,.6), breaks = c(.01,.1,.5)) +
  scale_x_continuous(limits = c(0,12), breaks = c(0,3,6,9,12)) +
  annotation_logticks(base = 10, sides = "l") +
  labs(x = "Time (hrs)", y = expression(paste("O.D."[600][nm]))) +
  theme_pubr(base_size = 10) + 
  theme(legend.position = "right"#,
#        panel.grid.major = element_line(color = "grey")
)
#  theme_transparent
GC_plot_sd
```